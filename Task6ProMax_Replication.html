<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligent Process Automation Challenge - Task 6 (Pro Max)</title>
    <style>
        /* --- CORE STYLES --- */
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --danger: #e74c3c;
            --success: #27ae60;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --warning: #f1c40f;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7f6;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        h1 {
            margin: 0;
            font-size: 2.2em;
            font-weight: 300;
        }

        h2 {
            margin-top: 0;
            color: var(--primary);
        }

        .subtitle {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
            display: block;
        }

        /* --- LANDING PAGE --- */
        #landing-page {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-top: 30px;
        }

        .instructions {
            background: #e8f4fd;
            border-left: 4px solid var(--accent);
            padding: 15px;
            margin-bottom: 30px;
        }

        .source-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .source-table th,
        .source-table td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        .source-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
        }

        .source-table tr:hover {
            background-color: #f1f1f1;
        }

        .btn-start {
            display: block;
            width: 200px;
            margin: 0 auto;
            padding: 15px;
            background-color: var(--success);
            color: white;
            text-align: center;
            border: none;
            border-radius: 50px;
            font-size: 1.2em;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-start:hover {
            transform: translateY(-2px);
            background-color: #219150;
        }

        /* --- GAME ARENA --- */
        #game-arena {
            display: none;
            display: flex;
            /* Flex but hidden initially */
            flex-direction: column;
            align-items: center;
            margin-top: 30px;
        }

        .hidden {
            display: none !important;
        }

        .score-board {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            font-size: 1.1em;
            background: white;
            padding: 10px 30px;
            border-radius: 50px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .stat-label {
            font-weight: bold;
            color: var(--dark);
        }

        .stat-value {
            color: var(--accent);
            font-family: monospace;
            font-size: 1.2em;
        }

        /* CHAOS CONTAINER */
        #chaos-form-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            position: relative;
            min-height: 400px;
            /* Prevent layout jumping */
        }

        /* Randomized Styles Hooks (will be generated by JS) */
        .sc-form-title {
            text-align: center;
            color: var(--primary);
            margin-bottom: 25px;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }

        .sc-field-wrapper {
            margin-bottom: 20px;
        }

        .sc-btn-submit {
            width: 100%;
            padding: 12px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 10px;
        }

        .sc-btn-submit:hover {
            background-color: #2980b9;
        }

        /* Form Feedback */
        #feedback-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            /* Large text */
            z-index: 10;
        }
    </style>
</head>

<body>

    <header>
        <div class="container">
            <h1>IPA Challenge <span style="font-weight:600">Task 6</span></h1>
            <span class="subtitle">Pro Max Edition: Semantic Grounding & Dynamic Planning</span>
        </div>
    </header>

    <div class="container">

        <!-- LANDING PAGE -->
        <div id="landing-page">
            <h2>Instructions</h2>
            <div class="instructions">
                <p><strong>Goal:</strong> Iterate through the list below. <strong>Step 1:</strong> Search for the user
                    by <em>Last Name</em>. <strong>Step 2:</strong> If they exist, submit an <strong>Add/Update</strong>
                    form. If they do not exist, submit a <strong>Remove/Delete</strong> form.</p>
                <p><strong>Challenge:</strong> The UI will change every round. Labels, positions, and input types will
                    be randomized. You must use semantic understanding to identify search and action fields.</p>
            </div>

            <h3>Source Data (Work Items)</h3>
            <table class="source-table" id="data-table">
                <thead>
                    <tr>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Job Description</th>
                        <th>Email</th>
                        <th>Manager</th>
                        <th>Level</th>
                        <th>Contact Number</th>
                        <th>Reason</th> <!-- NEW COLUMN -->
                    </tr>
                </thead>
                <tbody id="data-tbody">
                    <!-- Injected via JS -->
                </tbody>
            </table>

            <button class="btn-start" onclick="WindowManager.startGame()">Start Challenge</button>
        </div>

        <!-- GAME ARENA -->
        <div id="game-arena" class="hidden">
            <div class="score-board">
                <div><span class="stat-label">Round:</span> <span id="lbl-round" class="stat-value">1</span></div>
                <div><span class="stat-label">Score:</span> <span id="lbl-score" class="stat-value">0%</span></div>
                <div><span class="stat-label">Time:</span> <span id="lbl-time" class="stat-value">0s</span></div>
            </div>

            <div id="chaos-form-container">
                <!-- DYNAMIC FORM INJECTED HERE -->
            </div>
        </div>

    </div>

    <script>
        /**
         * INTELLIGENT PROCESS AUTOMATION CHALLENGE - TASK 6 PRO MAX EMULATOR
         * ------------------------------------------------------------------
         * This script procedurally generates a chaotic UI for testing resiliency.
         * Incorporates:
         * 1. Semantic Randomization (Synonyms)
         * 2. Spatial Chaos (Shuffling)
         * 3. DOM Variance (Random IDs/Classes)
         * 4. Dynamic Widgets (Reason Field)
         */

        // --- DATA SOURCE ---
        // Added 'reason' field for bot to know what to enter
        const MOCK_DATA = [
            { first: "Sarah", last: "Connor", role: "Security Chief", email: "s.connor@skynet.com", manager: "John Connor", level: "Expert", phone: "555-0199", exists: true, reason: "New Info" },
            { first: "James", last: "Bond", role: "Intelligence Officer", email: "007@mi6.gov.uk", manager: "M", level: "Pro Max", phone: "555-0007", exists: false, reason: "Deactivate" },
            { first: "Ellen", last: "Ripley", role: "Warrant Officer", email: "ripley@weyland.yutani.com", manager: "Mother", level: "Pro", phone: "555-1979", exists: true, reason: "Update" },
            { first: "Tony", last: "Stark", role: "Technician", email: "ironman@avengers.org", manager: "Pepper Potts", level: "Expert", phone: "555-3000", exists: true, reason: "Correction" },
            { first: "Bruce", last: "Wayne", role: "Philanthropist", email: "batman@gotham.city", manager: "Alfred", level: "Pro Max", phone: "555-1939", exists: false, reason: "Unregister" },
            { first: "Clark", last: "Kent", role: "Reporter", email: "superman@daily.planet", manager: "Perry White", level: "Advanced", phone: "555-1938", exists: true, reason: "New Info" },
            { first: "Diana", last: "Prince", role: "Curator", email: "wonderwoman@themyscira.gov", manager: "Hippolyta", level: "Pro Max", phone: "555-1941", exists: false, reason: "Not Found" },
            { first: "Peter", last: "Parker", role: "Photographer", email: "spidey@daily.bugle", manager: "J. Jonah Jameson", level: "Beginner", phone: "555-1962", exists: true, reason: "Correction" },
            { first: "Natasha", last: "Romanoff", role: "Spy", email: "widow@shield.gov", manager: "Nick Fury", level: "Expert", phone: "555-2010", exists: true, reason: "Update" },
            { first: "Wade", last: "Wilson", role: "Mercenary", email: "pool@dead.com", manager: "Blind Al", level: "Pro", phone: "555-1991", exists: false, reason: "System Error" }
        ];

        // --- CHAOS DICTIONARY ---
        const SYNONYMS = {
            first: ["First Name", "Given Name", "Forename", "F. Name", "Christian Name"],
            last: ["Last Name", "Surname", "Family Name", "L. Name", "Second Name"],
            role: ["Job Description", "Role", "Position", "Designation", "Title", "Function"],
            email: ["Email", "E-mail Address", "Electronic Mail", "User Email", "Contact Email"],
            manager: ["Manager", "Supervisor", "Reporting To", "Lead", "Direct Boss", "Team Lead"],
            level: ["Level", "Grade", "Rank", "Seniority", "Status", "Tier"],
            phone: ["Contact Number", "Phone", "Mobile", "Cell", "Tel", "Telephone"],
            reason: ["Reason", "Justification", "Cause", "Explanation", "Notes", "Comment"],
            search: ["Search", "Find User", "Lookup", "Query", "Check Database", "Locate"]
        };

        const FORM_TITLES = {
            add: ["Add User", "Create Entry", "New Request", "Register Employee", "Input Record", "System Entry"],
            remove: ["Remove User", "Delete Record", "Deactivate", "Clear Entry", "Purge Data", "Unregister"],
            search: ["Search Database", "Find Personnel", "User Lookup", "Registry Check", "System Trace"]
        };

        // --- CHAOS ENGINE ---
        class ChaosEngine {
            static getRandomId() { return 'id-' + Math.random().toString(36).substr(2, 9); }
            static getRandomClass() { return 'cls-' + Math.random().toString(36).substr(2, 5); }

            static selectRandom(array) {
                return array[Math.floor(Math.random() * array.length)];
            }

            static shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            static generateConfig(type) {
                // type: 'search', 'add', 'remove'
                const labels = {};
                Object.keys(SYNONYMS).forEach(key => labels[key] = this.selectRandom(SYNONYMS[key]));

                const title = this.selectRandom(FORM_TITLES[type]);

                let fields = [];
                if (type === 'search') {
                    fields = ['last']; // Only search by last name for now
                } else {
                    fields = ['first', 'last', 'role', 'email', 'manager', 'level', 'phone', 'reason'];
                }

                return {
                    type: type,
                    labels: labels,
                    title: title,
                    layout: this.selectRandom(['default', 'compact', 'grid']),
                    fieldOrder: this.shuffle(fields),
                    reasonWidget: this.selectRandom(['input', 'select', 'radio'])
                };
            }
        }

        // --- GAME STATE MANAGER ---
        class GameManager {
            constructor() {
                this.round = 0;
                this.score = 0;
                this.state = 'start'; // start, search, action, end
                this.startTime = null;
                this.timerInterval = null;
                this.totalFieldsFilled = 0;
                this.correctFieldsFilled = 0;
            }

            init() {
                this.renderTable();
            }

            renderTable() {
                const tbody = document.getElementById('data-tbody');
                tbody.innerHTML = MOCK_DATA.map(row => `
            <tr>
                <td>${row.first}</td>
                <td>${row.last}</td>
                <td>${row.role}</td>
                <td>${row.email}</td>
                <td>${row.manager}</td>
                <td>${row.level}</td>
                <td>${row.phone}</td>
                <td style="color:var(--accent); font-weight:bold;">${row.reason}</td>
            </tr>
        `).join('');
            }

            start() {
                this.round = 0;
                this.correctFieldsFilled = 0;
                this.totalFieldsFilled = 0;
                document.getElementById('landing-page').classList.add('hidden');
                document.getElementById('game-arena').classList.remove('hidden');

                this.startTime = Date.now();
                this.timerInterval = setInterval(() => {
                    const delta = Math.floor((Date.now() - this.startTime) / 1000);
                    document.getElementById('lbl-time').innerText = delta + "s";
                }, 1000);

                this.nextRound();
            }

            nextRound() {
                if (this.round >= MOCK_DATA.length) {
                    this.endGame();
                    return;
                }

                // Update UI stats
                document.getElementById('lbl-round').innerText = `${this.round + 1} / ${MOCK_DATA.length}`;

                this.startSearchPhase();
            }

            startSearchPhase() {
                this.state = 'search';
                const config = ChaosEngine.generateConfig('search');
                FormRenderer.render(config, (submission) => this.handleSearchSubmit(submission));
            }

            handleSearchSubmit(submission) {
                const currentData = MOCK_DATA[this.round];
                const enteredName = submission['last'];

                // Strict Validation: Must match the Last Name of the current target
                if (enteredName && enteredName.toLowerCase().trim() === currentData.last.toLowerCase().trim()) {
                    this.startActionPhase();
                } else {
                    // Feedback for failure
                    FormRenderer.showFeedback(false, () => {
                        // Retry?
                        this.startSearchPhase();
                    }, "Search Failed");
                }
            }

            startActionPhase() {
                this.state = 'action';
                const currentData = MOCK_DATA[this.round];
                const isExists = currentData.exists;
                const type = isExists ? 'add' : 'remove';

                const config = ChaosEngine.generateConfig(type);
                FormRenderer.render(config, (submission) => this.handleActionSubmit(submission, currentData));
            }

            handleActionSubmit(submission, truth) {
                // Validation Logic
                let roundCorrect = 0;
                let roundTotal = 0;

                const fields = ['first', 'last', 'role', 'email', 'manager', 'level', 'phone'];
                fields.forEach(f => {
                    roundTotal++;
                    if (submission[f] && submission[f].toLowerCase().trim() === truth[f].toLowerCase().trim()) {
                        roundCorrect++;
                    }
                });

                // Reason field must match now
                roundTotal++;
                if (submission.reason && submission.reason.toLowerCase().trim() === truth.reason.toLowerCase().trim()) {
                    roundCorrect++;
                }

                this.correctFieldsFilled += roundCorrect;
                this.totalFieldsFilled += roundTotal;

                const accuracy = Math.round((this.correctFieldsFilled / this.totalFieldsFilled) * 100);
                document.getElementById('lbl-score').innerText = accuracy + "%";

                const isPerfect = roundCorrect === roundTotal;
                FormRenderer.showFeedback(isPerfect, () => {
                    this.round++;
                    this.nextRound();
                });
            }

            endGame() {
                clearInterval(this.timerInterval);
                document.getElementById('chaos-form-container').innerHTML = `
            <div style="text-align:center; padding: 50px;">
                <h2 style="font-size: 3em; color: var(--success);">Game Over!</h2>
                <p style="font-size: 1.5em;">Final Score: <strong>${document.getElementById('lbl-score').innerText}</strong></p>
                <p>Time: ${document.getElementById('lbl-time').innerText}</p>
                <button class="sc-btn-submit" onclick="location.reload()">Restart</button>
            </div>
        `;
            }
        }

        // --- FORM RENDERER ---
        class FormRenderer {
            static render(config, onSubmitCallback) {
                const container = document.getElementById('chaos-form-container');
                container.innerHTML = '';

                // 1. Create Title
                const h2 = document.createElement('h2');
                h2.className = 'sc-form-title';
                h2.id = ChaosEngine.getRandomId();
                h2.innerText = config.title;
                container.appendChild(h2);

                // 2. Create Form Element
                const form = document.createElement('form');
                form.id = ChaosEngine.getRandomId();
                form.onsubmit = (e) => {
                    e.preventDefault();
                    const submission = {};

                    // Re-query inputs
                    Array.from(form.elements).forEach(el => {
                        if (el.dataset.semanticKey) {
                            submission[el.dataset.semanticKey] = el.value;
                            if (el.type === 'radio' && !el.checked) {
                                if (submission[el.dataset.semanticKey] === undefined) submission[el.dataset.semanticKey] = "";
                                return;
                            }
                            if (el.type === 'radio' && el.checked) {
                                submission[el.dataset.semanticKey] = el.value;
                            }
                        }
                    });

                    onSubmitCallback(submission);
                };

                // 3. Create Fields
                config.fieldOrder.forEach(key => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'sc-field-wrapper ' + ChaosEngine.getRandomClass();

                    const labelText = config.labels[key];
                    const labelPlacement = ChaosEngine.selectRandom(['top', 'bottom', 'placeholder']);

                    const label = document.createElement('label');
                    label.innerText = labelText;
                    label.className = ChaosEngine.getRandomClass();
                    label.style.display = 'block';
                    label.style.fontWeight = 'bold';
                    label.style.marginBottom = '5px';

                    let input;

                    if (key === 'reason') {
                        input = this.createWithWidget(config.reasonWidget);
                    } else {
                        input = document.createElement('input');
                        input.type = 'text';
                        input.className = 'sc-inp-text ' + ChaosEngine.getRandomClass();
                        input.style.width = '100%';
                        input.style.padding = '10px';
                        input.style.border = '1px solid #ccc';
                        input.style.borderRadius = '4px';
                    }

                    if (input instanceof NodeList || Array.isArray(input)) {
                        input.forEach(i => i.dataset.semanticKey = key);
                    } else {
                        if (input.dataset) input.dataset.semanticKey = key;
                        else input.querySelectorAll('input').forEach(i => i.dataset.semanticKey = key);
                    }

                    if (labelPlacement === 'top') {
                        wrapper.appendChild(label);
                        this.appendInput(wrapper, input);
                    } else if (labelPlacement === 'bottom') {
                        this.appendInput(wrapper, input);
                        wrapper.appendChild(label);
                    } else {
                        if (key !== 'reason' && config.reasonWidget === 'input') {
                            input.placeholder = labelText;
                            this.appendInput(wrapper, input);
                        } else if (key === 'reason') {
                            wrapper.appendChild(label);
                            this.appendInput(wrapper, input);
                        } else {
                            input.placeholder = labelText;
                            this.appendInput(wrapper, input);
                        }
                    }

                    form.appendChild(wrapper);
                });

                // 4. Submit Button
                const btn = document.createElement('button');
                btn.innerText = config.type === 'search' ? ChaosEngine.selectRandom(SYNONYMS.search) : "Submit";
                btn.className = 'sc-btn-submit ' + ChaosEngine.getRandomClass();
                btn.type = 'submit';
                form.appendChild(btn);

                container.appendChild(form);
            }

            static appendInput(parent, input) {
                if (input instanceof HTMLElement) {
                    parent.appendChild(input);
                } else if (typeof input === 'object' && input.length) {
                    input.forEach(el => {
                        parent.appendChild(el);
                        if (el.type === 'radio') {
                            const sp = document.createElement('span');
                            sp.innerText = el.value + " ";
                            sp.style.marginRight = '10px';
                            parent.appendChild(sp);
                        }
                    });
                }
            }

            static createWithWidget(type) {
                // Updated options to match our MOCK_DATA reason values for better playability
                const options = ['New Info', 'Update', 'Correction', 'System Error', 'Did Not Enroll', 'Deactivate', 'Unregister', 'Not Found'];

                if (type === 'select') {
                    const sel = document.createElement('select');
                    sel.style.width = '100%';
                    sel.style.padding = '10px';
                    options.forEach(opt => {
                        const o = document.createElement('option');
                        o.value = opt;
                        o.innerText = opt;
                        sel.appendChild(o);
                    });
                    return sel;
                } else if (type === 'radio') {
                    const arr = [];
                    // Random subset to vary the logical difficulty (sometimes the answer might be missing in a real challenge, but for emulator we ensure it's there or user has to pick closest? No, let's keep it simple)
                    // Correction: For emulator playability, we should ensure the CORRECT answer is always one of the options.
                    // But we don't have access to the current "truth" in this static method easily without passing it down.
                    // Let's just show ALL options for radio to be safe, or a large random subset.
                    // Let's show all for consistency.
                    options.forEach(val => {
                        const r = document.createElement('input');
                        r.type = 'radio';
                        r.name = 'reason_radio_' + Math.random().toString(36).substr(2, 5);
                        r.value = val;
                        arr.push(r);
                    });
                    return arr;
                } else {
                    const inp = document.createElement('input');
                    inp.type = 'text';
                    inp.style.width = '100%';
                    inp.style.padding = '10px';
                    return inp;
                }
            }

            static showFeedback(success, callback, customMsg) {
                const overlay = document.createElement('div');
                overlay.id = 'feedback-overlay';
                const msg = customMsg || (success ? "✔ Success" : "✖ Missed");
                overlay.innerHTML = `<div style="color: ${success ? 'green' : 'red'}; font-weight: bold;">${msg}</div>`;

                document.getElementById('chaos-form-container').appendChild(overlay);

                setTimeout(() => {
                    overlay.remove();
                    callback();
                }, 800);
            }
        }

        const Game = new GameManager();

        // Global Access
        window.WindowManager = {
            startGame: () => Game.start()
        };

        // Init
        Game.init();

    </script>

</body>

</html>